#!/usr/bin/env node

/**
 * OpenCode Mobile Plugin - CLI Entry Point
 * Run with: npx opencode-mobile [COMMAND]
 */

import { main as auditMain } from "../dist/src/cli/index.js";
import { main as qrMain } from "../dist/src/cli/qr.js";
import { main as installMain } from "../dist/src/cli/install.js";
import { main as uninstallMain } from "../dist/src/cli/uninstall.js";
import { main as updateMain } from "../dist/src/cli/update.js";

const args = process.argv.slice(2);
const subcommand = args[0];

const run = async () => {
  if (subcommand === "qr") {
    await qrMain(args.slice(1));
    return;
  }

  if (subcommand === "audit") {
    await auditMain(args.slice(1));
    return;
  }

  if (subcommand === "install") {
    await installMain(args.slice(1));
    return;
  }

  if (subcommand === "uninstall") {
    await uninstallMain(args.slice(1));
    return;
  }

  if (subcommand === "update") {
    await updateMain(args.slice(1));
    return;
  }

  if (subcommand === "--help" || subcommand === "-h" || !subcommand) {
    console.log(`
OpenCode Mobile Plugin

USAGE:
  npx opencode-mobile <command> [options]

COMMANDS:
  install       Install the plugin globally
  uninstall     Remove the plugin globally
  update        Update to the latest version
  audit         Run endpoint audit
  qr            Show QR code for mobile connection

EXAMPLES:
  npx opencode-mobile install
  npx opencode-mobile update
  npx opencode-mobile uninstall --yes
  npx opencode-mobile audit --tunnel-only
`);
    return;
  }

  console.error(`Unknown command: ${subcommand}`);
  console.error("Run 'npx opencode-mobile --help' for usage.");
  process.exit(1);
};

run().catch((error) => {
  console.error("Fatal error:", error instanceof Error ? error.message : String(error));
  process.exit(1);
});
